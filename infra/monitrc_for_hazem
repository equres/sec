# vim:set tw=1000:
set daemon 5
set log syslog

#set onreboot start

#check file lp_bin with path /tmp/lp
#   if changed timestamp then exec "/usr/bin/say hello"

CHECK PROCESS sec MATCHING ".*sec.linux.*"
	start program = "/bin/sh -c '/home/sec/sec.linux :9001 2>&1 > /tmp/log.sec &'"
		 as uid "sec" and gid "sec" WITH TIMEOUT 5 SECONDS
	stop program = "/bin/sh -c 'killall -s SIGTERM sec.linux'"
		 as uid "sec" and gid "sec" WITH TIMEOUT 5 SECONDS


        if failed
		port 9001 protocol http
		with http headers [Host: 127.0.0.1, Cache-Control: no-cache, Cookie: csrftoken=placeholder]
		and request /x/uptime with content = ".*OK"
        then
		restart



CHECK FILE sec_bin WITH PATH /home/sec/sec.linux
	if changed timestamp then exec "/bin/sh -c 'killall -s SIGTERM sec.linux'"

CHECK DIRECTORY sec_dir WITH PATH /home/sec
	if changed timestamp then exec "/bin/echo meh"

CHECK FILE sec_bin_new WITH PATH /home/sec/sec.linux.tmp
	if changed timestamp then exec "/bin/cp -fp /home/sec/sec.linux.tmp /home/sec/sec.linux"
